# Deploy ke cPanel Node.js App

## ğŸš¨ CRITICAL: BUILD MUST BE DONE LOCALLY!

**Turbopack Compilation Requires Too Many Resources for cPanel Shared Hosting**

**DO NOT try to build on cPanel server!** You will get:
- `OS can't spawn worker thread: Resource temporarily unavailable`
- `pthread_create: Resource temporarily unavailable`
- `Killed` (build process terminated)

**MANDATORY STEPS:**

### 1ï¸âƒ£ BUILD LOCALLY (Windows/Mac/Linux)
```bash
# On your local machine:
npm install
npm run build
npm start        # Test locally - CSS must load!
```

Results: Creates `.next/` folder with compiled app

### 2ï¸âƒ£ UPLOAD TO cPANEL
Upload THESE folders/files ONLY:
- âœ… `src/`
- âœ… `public/`
- âœ… `.next/`        â† CRITICAL! Pre-compiled build
- âœ… `package.json`
- âœ… `next.config.ts`
- âœ… `.gitignore` (if using Git)

**DO NOT upload:**
- âŒ `node_modules/` (upload from Windows will break on Linux!)
- âŒ `.next.lock` files

### 3ï¸âƒ£ INSTALL DEPENDENCIES ON cPANEL (SSH)
```bash
cd ~/repositories/binarahmatika-web
npm install --production   # This will install LINUX-COMPATIBLE binaries
```

Done! Passenger will auto-start the app.

---

## Recommended: next start (Paling Simple & Reliable)

### 1. Upload ke Server
- Via FTP/cPanel File Manager upload folder ke: `repositories/binarahmatika-web`
- Atau via Git Clone (jika support)
- **Include .next folder!** (hasil dari npm run build)

### 2. di Server: SSH Commands
```bash
cd ~/repositories/binarahmatika-web
npm install --production   # Install deps
npm run build              # Generate .next
npm start                  # Test (Ctrl+C to stop)
```

### 3. Setup di cPanel
1. Login ke **cPanel**
2. Go to: **Setup Node.js App** (atau **Application Manager**)
3. Click **Create Application**
4. Fill in EXACTLY:
   - **Node.js version**: 18+ (atau Latest)
   - **Application mode**: Production
   - **Application root**: `/home/binarahm/repositories/binarahmatika-web`
   - **Application startup file**: (kosongkan - Leave empty!)
   - **Application URL**: Your domain (e.g., binarahmatika-group.com)
   - **Passenger log file**: `/home/binarahm/logs/passenger.log` (optional)
   - **Environment variables**:
     ```
     NODE_ENV=production
     ```
   - **Run "npm install" when creating/updating?**: âœ“ Checked
   - **Run "npm start" script?**: âœ“ Checked
5. Click **Create**
6. **Restart Application**

### 4. Troubleshooting 500 Error
Jika dapat error 500 (Internal Server Error):

1. **Check di SSH:**
   ```bash
   cd ~/repositories/binarahmatika-web
   npm start    # Lihat error detail
   ```

2. **Check .next folder:**
   ```bash
   ls -la .next    # Harus ada file dan folder
   ```

3. **Check logs:**
   ```bash
   cat ~/.forever/logs/forever.log
   cat ~/logs/passenger.log
   ```

4. **Common causes & fixes:**
   - âŒ `.next` folder tidak ada â†’ Run: `npm run build`
   - âŒ `node_modules` tidak ada â†’ Run: `npm install --production`
   - âŒ PORT conflict â†’ Restart di cPanel
   - âŒ Build error â†’ Check npm start output

---

## 5. Test
Open browser â†’ `https://yourdomain.com` âœ…

---

## Configuration

### package.json
```json
"start": "next start"  // Di-jalankan oleh cPanel
```

### next.config.ts
```typescript
// Normal mode - CSS dan assets ter-load dengan benar
```

---

## File Structure

```
~/repositories/binarahmatika-web/
â”œâ”€â”€ .next/              â­ PENTING! Generated by npm run build
â”œâ”€â”€ node_modules/       â­ PENTING! Generated by npm install
â”œâ”€â”€ public/             (static assets)
â”œâ”€â”€ src/                (source code)
â”œâ”€â”€ package.json
â”œâ”€â”€ next.config.ts
â””â”€â”€ ...
```

---

## ğŸ“‹ Checklist Pre-Deploy

- [ ] Locally: `npm install --production` âœ“
- [ ] Locally: `npm run build` âœ“  
- [ ] Locally: `npm start` works? âœ“
- [ ] `.next` folder exists? âœ“
- [ ] `node_modules` exists? âœ“
- [ ] Upload .next folder ke server!
- [ ] Upload node_modules ke server! (atau run npm install di server)
- [ ] cPanel setup: Aplikasi root path benar
- [ ] cPanel setup: npm start checked
- [ ] Restart aplikasi di cPanel
- [ ] Test di browser

---

## ğŸ“– Helpful Resources

- [CPANEL_TROUBLESHOOTING.md](CPANEL_TROUBLESHOOTING.md) - Fix error 500 & common issues
- [cpanel-verify.sh](cpanel-verify.sh) - Verify setup sebelum deploy
- Next.js Docs: https://nextjs.org/docs
- cPanel Node.js App: https://documentation.cpanel.net/

---

âœ… **Selesai!** ğŸš€


